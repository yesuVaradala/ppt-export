<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Export Demo — PPT & PNG</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; background: #fafafa; color:#222 }
    .container { max-width: 900px; margin: 0 auto }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px }
    h1 { font-size:18px; margin:0 }
    .card { background:white; padding:16px; border-radius:8px; box-shadow:0 8px 24px rgba(18,18,18,0.06); margin-top:16px }
    canvas { width:100% !important; height:400px !important }
    .controls { display:flex; gap:8px; margin-top:12px }
    button { padding:8px 12px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer }
    button.primary { background:#0078d4; color:white; border-color:transparent }
    small { color:#555 }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Export Demo — Chart to PNG / PPTX</h1>
      <small>Standalone demo for this repo</small>
    </header>

    <div class="card">
      <canvas id="demoChart"></canvas>

      <div class="controls">
        <button id="downloadPng">Download PNG</button>
        <button id="exportPptx" class="primary">Export to PPTX</button>
        <button id="refresh">Randomize Data</button>
      </div>
      <p style="margin-top:10px"><small>Uses Chart.js for drawing and PptxGenJS to create a PowerPoint with the chart image embedded.</small></p>
    </div>

    <p style="margin-top:20px"><small>Open this file in a browser (double-click or run a static server). If you use a modern browser this demo will download a PNG and generate a PPTX file containing the chart.</small></p>
  </div>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PptxGenJS (CDN bundle) -->
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.10.0/dist/pptxgen.bundle.js"></script>

  <script>
    const ctx = document.getElementById('demoChart').getContext('2d');

    function randomData() {
      return Array.from({length: 8}, () => Math.floor(Math.random() * 100) + 10);
    }

    const labels = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'];

    const data = {
      labels,
      datasets: [{
        label: 'Sample Series',
        data: randomData(),
        borderColor: '#0078d4',
        backgroundColor: 'rgba(0,120,212,0.08)',
        tension: 0.3,
        fill: true,
      }]
    };

    const config = {
      type: 'line',
      data,
      options: {
        responsive: true,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true } }
      }
    };

    let chart = new Chart(ctx, config);

    // Download the chart as PNG
    document.getElementById('downloadPng').addEventListener('click', () => {
      const canvas = document.getElementById('demoChart');
      // Convert to data URL (PNG)
      const dataUrl = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = 'chart.png';
      document.body.appendChild(link);
      link.click();
      link.remove();
    });

    // Export to PPTX using PptxGenJS
    document.getElementById('exportPptx').addEventListener('click', async () => {
      try {
        const canvas = document.getElementById('demoChart');
        const dataUrl = canvas.toDataURL('image/png');
        // PptxGenJS expects base64 without the prefix data:...;base64,
        const base64 = dataUrl.split(',')[1];

        const pptx = new PptxGenJS();
        const slide = pptx.addSlide();

        // Add a title
        slide.addText('Chart Export', { x:0.5, y:0.3, fontSize:18, bold:true });

        // Add the image to the slide
        slide.addImage({ data: 'data:image/png;base64,' + base64, x:0.5, y:1, w:9, h:5 });

        // Save the PPTX file
        await pptx.writeFile({ fileName: 'chart-export.pptx' });
      } catch (err) {
        alert('PPTX export failed: ' + (err && err.message ? err.message : err));
        console.error(err);
      }
    });

    // Refresh chart data
    document.getElementById('refresh').addEventListener('click', () => {
      chart.data.datasets[0].data = randomData();
      chart.update();
    });
  </script>
</body>
</html>